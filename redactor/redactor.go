//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package redactor ;import (_cg "errors";_g "fmt";
	_f "github.com/magnus195/unipdf/v3/common";
	_be "github.com/magnus195/unipdf/v3/contentstream";
	_fg "github.com/magnus195/unipdf/v3/core";
	_fa "github.com/magnus195/unipdf/v3/creator";
	_cf "github.com/magnus195/unipdf/v3/extractor";
	_dd "github.com/magnus195/unipdf/v3/model";_bb "io";_b "regexp";_d "sort";_a "strings";);func _gdg (_df *_cf .TextMarkArray )int {_gc :=0;_caf :=_df .Elements ();if _caf [0].Text =="\u0020"{_gc ++;};if _caf [_df .Len ()-1].Text =="\u0020"{_gc ++;};return _gc ;
};

// RedactionTerm holds the regexp pattern and the replacement string for the redaction process.
type RedactionTerm struct{Pattern *_b .Regexp ;};func _eg (_cbd *_dd .PdfFont ,_cabe _cf .TextMark )float64 {_cgdc :=0.001;_gea :=_cabe .Th /100;if _cbd .Subtype ()=="\u0054\u0079\u0070e\u0033"{_cgdc =1;};_dgf ,_bgc :=_cbd .GetRuneMetrics (' ');if !_bgc {_dgf ,_bgc =_cbd .GetCharMetrics (32);
};if !_bgc {_dgf ,_ =_dd .DefaultFont ().GetRuneMetrics (' ');};_cce :=_cgdc *((_dgf .Wx *_cabe .FontSize +_cabe .Tc +_cabe .Tw )/_gea );return _cce ;};func _cbdb (_fba []localSpanMarks )(map[string ][]localSpanMarks ,[]string ){_ef :=make (map[string ][]localSpanMarks );
_beb :=[]string {};for _ ,_efe :=range _fba {_faf :=_efe ._ffa ;if _ce ,_eag :=_ef [_faf ];_eag {_ef [_faf ]=append (_ce ,_efe );}else {_ef [_faf ]=[]localSpanMarks {_efe };_beb =append (_beb ,_faf );};};return _ef ,_beb ;};func _cc (_bc *_be .ContentStreamOperation ,_agb _fg .PdfObject ,_afb []localSpanMarks )error {_dc ,_dca :=_fg .GetArray (_bc .Params [0]);
_bg :=[]_fg .PdfObject {};if !_dca {_f .Log .Debug ("\u0045\u0052\u0052OR\u003a\u0020\u0054\u004a\u0020\u006f\u0070\u003d\u0025s\u0020G\u0065t\u0041r\u0072\u0061\u0079\u0056\u0061\u006c\u0020\u0066\u0061\u0069\u006c\u0065\u0064",_bc );return _g .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_bc );
};_de ,_agg :=_cbdb (_afb );if len (_agg )==1{_deb :=_agg [0];_bdd :=_de [_deb ];if len (_bdd )==1{_fab :=_bdd [0];_cae :=_fab ._cdd ;_cag :=_dec (_cae );_cgd ,_aeg :=_dcc (_agb ,_cag );if _aeg !=nil {return _aeg ;};_fad ,_aeg :=_cfd (_fab ,_cae ,_cag ,_cgd ,_deb );
if _aeg !=nil {return _aeg ;};for _ ,_gb :=range _dc .Elements (){if _gb ==_agb {_bg =append (_bg ,_fad ...);}else {_bg =append (_bg ,_gb );};};}else {_ga :=_bdd [0]._cdd ;_gg :=_dec (_ga );_gf ,_dgb :=_dcc (_agb ,_gg );if _dgb !=nil {return _dgb ;};_bcc ,_dgb :=_ded (_gf ,_bdd );
if _dgb !=nil {return _dgb ;};_ea :=_dga (_bcc );_afg :=_ece (_gf ,_ea ,_gg );for _ ,_gac :=range _dc .Elements (){if _gac ==_agb {_bg =append (_bg ,_afg ...);}else {_bg =append (_bg ,_gac );};};};_bc .Params [0]=_fg .MakeArray (_bg ...);}else if len (_agg )> 1{_dfe :=_afb [0];
_aag :=_dfe ._cdd ;_ ,_gef :=_ba (_aag );_ggc :=_aag .Elements ()[_gef ];_feb :=_ggc .Font ;_bba ,_baa :=_dcc (_agb ,_feb );if _baa !=nil {return _baa ;};_ed ,_baa :=_ded (_bba ,_afb );if _baa !=nil {return _baa ;};_acb :=_dga (_ed );_fgc :=_ece (_bba ,_acb ,_feb );
for _ ,_cab :=range _dc .Elements (){if _cab ==_agb {_bg =append (_bg ,_fgc ...);}else {_bg =append (_bg ,_cab );};};_bc .Params [0]=_fg .MakeArray (_bg ...);};return nil ;};func _cdc (_cdcb string ,_bge *_dd .PdfFont )[]byte {_bac ,_adc :=_bge .StringToCharcodeBytes (_cdcb );
if _adc !=0{_f .Log .Debug ("\u0057\u0041\u0052\u004e\u003a\u0020\u0073\u006fm\u0065\u0020\u0072un\u0065\u0073\u0020\u0063\u006f\u0075l\u0064\u0020\u006e\u006f\u0074\u0020\u0062\u0065\u0020\u0065\u006e\u0063\u006f\u0064\u0065d\u002e\u000a\u0009\u0025\u0073\u0020\u002d\u003e \u0025\u0076",_cdcb ,_bac );
};return _bac ;};func _fcd (_ddd *_be .ContentStreamOperation ,_dde _fg .PdfObject ,_fcdc []localSpanMarks )error {var _bfge *_fg .PdfObjectArray ;_fd ,_aegf :=_cbdb (_fcdc );if len (_aegf )==1{_daa :=_aegf [0];_cafc :=_fd [_daa ];if len (_cafc )==1{_fda :=_cafc [0];
_dcf :=_fda ._cdd ;_daac :=_dec (_dcf );_fca ,_dcb :=_dcc (_dde ,_daac );if _dcb !=nil {return _dcb ;};_cgb ,_dcb :=_cfd (_fda ,_dcf ,_daac ,_fca ,_daa );if _dcb !=nil {return _dcb ;};_bfge =_fg .MakeArray (_cgb ...);}else {_abd :=_cafc [0]._cdd ;_aeb :=_dec (_abd );
_ged ,_fade :=_dcc (_dde ,_aeb );if _fade !=nil {return _fade ;};_dfa ,_fade :=_ded (_ged ,_cafc );if _fade !=nil {return _fade ;};_ddf :=_dga (_dfa );_gce :=_ece (_ged ,_ddf ,_aeb );_bfge =_fg .MakeArray (_gce ...);};}else if len (_aegf )> 1{_gebg :=_fcdc [0];
_gba :=_gebg ._cdd ;_ ,_ff :=_ba (_gba );_cff :=_gba .Elements ()[_ff ];_fea :=_cff .Font ;_add ,_gcc :=_dcc (_dde ,_fea );if _gcc !=nil {return _gcc ;};_aba ,_gcc :=_ded (_add ,_fcdc );if _gcc !=nil {return _gcc ;};_dgg :=_dga (_aba );_bfd :=_ece (_add ,_dgg ,_fea );
_bfge =_fg .MakeArray (_bfd ...);};_ddd .Params [0]=_bfge ;_ddd .Operand ="\u0054\u004a";return nil ;};func (_dgaf *regexMatcher )match (_eafg string )([]*matchedIndex ,error ){_gebcf :=_dgaf ._dcfc .Pattern ;if _gebcf ==nil {return nil ,_cg .New ("\u006e\u006f\u0020\u0070at\u0074\u0065\u0072\u006e\u0020\u0063\u006f\u006d\u0070\u0069\u006c\u0065\u0064");
};var (_cee =_gebcf .FindAllStringIndex (_eafg ,-1);_cccc []*matchedIndex ;);for _ ,_bbba :=range _cee {_cccc =append (_cccc ,&matchedIndex {_cafe :_bbba [0],_eeg :_bbba [1],_egce :_eafg [_bbba [0]:_bbba [1]]});};return _cccc ,nil ;};

// RectangleProps defines properties of the redaction rectangle to be drawn.
type RectangleProps struct{FillColor _fa .Color ;BorderWidth float64 ;FillOpacity float64 ;};

// Write writes the content of `re.creator` to writer of type io.Writer interface.
func (_faa *Redactor )Write (writer _bb .Writer )error {return _faa ._ggcf .Write (writer )};func _dcc (_beeg _fg .PdfObject ,_bef *_dd .PdfFont )(string ,error ){_cfc ,_aae :=_fg .GetStringBytes (_beeg );if !_aae {return "",_fg .ErrTypeError ;};_bcac :=_bef .BytesToCharcodes (_cfc );
_fec ,_fdff ,_fag :=_bef .CharcodesToStrings (_bcac );if _fag > 0{_f .Log .Debug ("\u0072\u0065nd\u0065\u0072\u0054e\u0078\u0074\u003a\u0020num\u0043ha\u0072\u0073\u003d\u0025\u0064\u0020\u006eum\u004d\u0069\u0073\u0073\u0065\u0073\u003d%\u0064",_fdff ,_fag );
};_fadd :=_a .Join (_fec ,"");return _fadd ,nil ;};func _efa (_fefe ,_ccee ,_agf float64 )float64 {_agf =_agf /100;_faff :=(-1000*_fefe )/(_ccee *_agf );return _faff ;};func _geee (_cdfg RedactionTerm )(*regexMatcher ,error ){return &regexMatcher {_dcfc :_cdfg },nil };
func _bee (_dab *_cf .TextMarkArray )(float64 ,error ){_aega ,_bae :=_dab .BBox ();if !_bae {return 0.0,_g .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_dab );
};_abae :=_gdg (_dab );_bgcc :=0.0;_ ,_fcga :=_ba (_dab );_cgf :=_dab .Elements ()[_fcga ];_fdf :=_cgf .Font ;if _abae > 0{_bgcc =_eg (_fdf ,_cgf );};_aaa :=(_aega .Urx -_aega .Llx );_aaa =_aaa +_bgcc *float64 (_abae );Tj :=_efa (_aaa ,_cgf .FontSize ,_cgf .Th );
return Tj ,nil ;};func _ece (_ebaa string ,_gff []replacement ,_gdbg *_dd .PdfFont )[]_fg .PdfObject {_cea :=[]_fg .PdfObject {};_fdg :=0;_deg :=_ebaa ;for _bbcd ,_gca :=range _gff {_bgd :=_gca ._bd ;_fge :=_gca ._fb ;_eda :=_gca ._cge ;_fef :=_fg .MakeFloat (_fge );
if _fdg > _bgd ||_bgd ==-1{continue ;};_bbcc :=_ebaa [_fdg :_bgd ];_bce :=_cdc (_bbcc ,_gdbg );_dggc :=_fg .MakeStringFromBytes (_bce );_cea =append (_cea ,_dggc );_cea =append (_cea ,_fef );_bega :=_bgd +len (_eda );_deg =_ebaa [_bega :];_fdg =_bega ;
if _bbcd ==len (_gff )-1{_bce =_cdc (_deg ,_gdbg );_dggc =_fg .MakeStringFromBytes (_bce );_cea =append (_cea ,_dggc );};};return _cea ;};func _dfbc (_cfcg *_cf .TextMarkArray ,_ddc int ,_ecd int )int {_gfd :=_cfcg .Elements ();_agdg :=_ddc -1;_ecgg :=_ddc +1;
_agae :=-1;if _agdg >=0{_eac :=_gfd [_agdg ];_ebd :=_eac .ObjString ;_baf :=len (_ebd );_gfba :=_eac .Index ;if _gfba +1< _baf {_agae =_agdg ;return _agae ;};};if _ecgg < len (_gfd ){_ebdg :=_gfd [_ecgg ];_fccf :=_ebdg .ObjString ;if _fccf [0]!=_ebdg .Text {_agae =_ecgg ;
return _agae ;};};return _agae ;};func _cb (_ae *_be .ContentStreamOperations ,_ca map[_fg .PdfObject ][]localSpanMarks )error {for _ab ,_aed :=range _ca {if _ab ==nil {continue ;};_da ,_ac ,_fc :=_db (_ae ,_ab );if !_fc {_f .Log .Debug ("Pd\u0066\u004fb\u006a\u0065\u0063\u0074\u0020\u0025\u0073\u006e\u006ft\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0069\u006e\u0020\u0073\u0069\u0064\u0065\u0020\u0074\u0068\u0065\u0020\u0063\u006f\u006e\u0074\u0065\u006e\u0074\u0073\u0074r\u0065a\u006d\u0020\u006f\u0070\u0065\u0072\u0061\u0074i\u006fn\u0020\u0025s",_ab ,_ae );
return nil ;};if _da .Operand =="\u0054\u006a"{_gd :=_fcd (_da ,_ab ,_aed );if _gd !=nil {return _gd ;};}else if _da .Operand =="\u0054\u004a"{_abe :=_cc (_da ,_ab ,_aed );if _abe !=nil {return _abe ;};}else if _da .Operand =="\u0027"||_da .Operand =="\u0022"{_cbb :=_ad (_ae ,_da .Operand ,_ac );
if _cbb !=nil {return _cbb ;};_cbb =_fcd (_da ,_ab ,_aed );if _cbb !=nil {return _cbb ;};};};return nil ;};type replacement struct{_cge string ;_fb float64 ;_bd int ;};func _gbdcf (_cgbd []*targetMap ){for _eef ,_dbd :=range _cgbd {for _gge ,_gfbd :=range _cgbd {if _eef !=_gge {_egf ,_dded :=_cdf (*_dbd ,*_gfbd );
if _egf {_abf (_gfbd ,_dded );};};};};};func _ffaa (_eafd *matchedIndex ,_fde [][]int )(bool ,[][]int ){_febc :=[][]int {};for _ ,_dedd :=range _fde {if _eafd ._cafe < _dedd [0]&&_eafd ._eeg > _dedd [1]{_febc =append (_febc ,_dedd );};};return len (_febc )> 0,_febc ;
};func _dfc (_gcd string )(string ,[][]int ){_dff :=_b .MustCompile ("\u005c\u006e");_abege :=_dff .FindAllStringIndex (_gcd ,-1);_edgg :=_dff .ReplaceAllString (_gcd ,"\u0020");return _edgg ,_abege ;};func _abf (_gaab *targetMap ,_ggde []int ){var _decg [][]int ;
for _dfg ,_eff :=range _gaab ._eee {if _bcge (_dfg ,_ggde ){continue ;};_decg =append (_decg ,_eff );};_gaab ._eee =_decg ;};func _ba (_aga *_cf .TextMarkArray )(_fg .PdfObject ,int ){var _dfd _fg .PdfObject ;_ec :=-1;for _cafg ,_agab :=range _aga .Elements (){_dfd =_agab .DirectObject ;
_ec =_cafg ;if _dfd !=nil {break ;};};return _dfd ,_ec ;};

// Redactor represents a Redactor object.
type Redactor struct{_dade *_dd .PdfReader ;_cca *RedactionOptions ;_ggcf *_fa .Creator ;_aaee *RectangleProps ;};func _afgf (_abcf []*matchedIndex )[]*targetMap {_fdaf :=make (map[string ][][]int );_abaef :=[]*targetMap {};for _ ,_ede :=range _abcf {_ccc :=_ede ._egce ;
_egdd :=[]int {_ede ._cafe ,_ede ._eeg };if _acg ,_dcdb :=_fdaf [_ccc ];_dcdb {_fdaf [_ccc ]=append (_acg ,_egdd );}else {_fdaf [_ccc ]=[][]int {_egdd };};};for _geg ,_gcee :=range _fdaf {_ffae :=&targetMap {_dcff :_geg ,_eee :_gcee };_abaef =append (_abaef ,_ffae );
};return _abaef ;};type targetMap struct{_dcff string ;_eee [][]int ;};func _bcf (_eed []int ,_bgfa *_cf .TextMarkArray ,_bfb string )(*_cf .TextMarkArray ,matchedBBox ,error ){_daf :=matchedBBox {};_dcd :=_eed [0];_cad :=_eed [1];_ecgd :=len (_bfb )-len (_a .TrimLeft (_bfb ,"\u0020"));
_afgd :=len (_bfb )-len (_a .TrimRight (_bfb ,"\u0020\u000a"));_dcd =_dcd +_ecgd ;_cad =_cad -_afgd ;_bfb =_a .Trim (_bfb ,"\u0020\u000a");_gdce ,_deee :=_bgfa .RangeOffset (_dcd ,_cad );if _deee !=nil {return nil ,_daf ,_deee ;};_gbf ,_ggb :=_gdce .BBox ();
if !_ggb {return nil ,_daf ,_g .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_gdce );
};_daf =matchedBBox {_bbcb :_bfb ,_bgdc :_gbf };return _gdce ,_daf ,nil ;};type matchedBBox struct{_bgdc _dd .PdfRectangle ;_bbcb string ;};

// WriteToFile writes the redacted document to file specified by `outputPath`.
func (_gbbe *Redactor )WriteToFile (outputPath string )error {if _eacg :=_gbbe ._ggcf .WriteToFile (outputPath );_eacg !=nil {return _g .Errorf ("\u0066\u0061\u0069l\u0065\u0064\u0020\u0074o\u0020\u0077\u0072\u0069\u0074\u0065\u0020t\u0068\u0065\u0020\u006f\u0075\u0074\u0070\u0075\u0074\u0020\u0066\u0069\u006c\u0065");
};return nil ;};

// New instantiates a Redactor object with given PdfReader and `regex` pattern.
func New (reader *_dd .PdfReader ,opts *RedactionOptions ,rectProps *RectangleProps )*Redactor {if rectProps ==nil {rectProps =RedactRectanglePropsNew ();};return &Redactor {_dade :reader ,_cca :opts ,_ggcf :_fa .New (),_aaee :rectProps };};func _cfd (_bde localSpanMarks ,_gbd *_cf .TextMarkArray ,_gfb *_dd .PdfFont ,_ccef ,_ggce string )([]_fg .PdfObject ,error ){_eaf :=_fccb (_gbd );
Tj ,_gbb :=_bee (_gbd );if _gbb !=nil {return nil ,_gbb ;};_gdb :=len (_ccef );_bda :=len (_eaf );_ceg :=-1;_fae :=_fg .MakeFloat (Tj );if _eaf !=_ggce {_abc :=_bde ._cddd ;if _abc ==0{_ceg =_a .LastIndex (_ccef ,_eaf );}else {_ceg =_a .Index (_ccef ,_eaf );
};}else {_ceg =_a .Index (_ccef ,_eaf );};_gfc :=_ceg +_bda ;_dfb :=[]_fg .PdfObject {};if _ceg ==0&&_gfc ==_gdb {_dfb =append (_dfb ,_fae );}else if _ceg ==0&&_gfc < _gdb {_aca :=_cdc (_ccef [_gfc :],_gfb );_fac :=_fg .MakeStringFromBytes (_aca );_dfb =append (_dfb ,_fae ,_fac );
}else if _ceg > 0&&_gfc >=_gdb {_bec :=_cdc (_ccef [:_ceg ],_gfb );_cfda :=_fg .MakeStringFromBytes (_bec );_dfb =append (_dfb ,_cfda ,_fae );}else if _ceg > 0&&_gfc < _gdb {_fcae :=_cdc (_ccef [:_ceg ],_gfb );_fcc :=_cdc (_ccef [_gfc :],_gfb );_abab :=_fg .MakeStringFromBytes (_fcae );
_def :=_fg .MakeString (string (_fcc ));_dfb =append (_dfb ,_abab ,_fae ,_def );};return _dfb ,nil ;};func (_bfde *Redactor )redactPage (_dddd *_be .ContentStreamOperations ,_cac *_dd .PdfPageResources )([]matchedBBox ,*_be .ContentStreamOperations ,error ){_cbg ,_ffe :=_cf .NewFromContents (_dddd .String (),_cac );
if _ffe !=nil {return nil ,nil ,_ffe ;};_gaa ,_ ,_ ,_ffe :=_cbg .ExtractPageText ();if _ffe !=nil {return nil ,nil ,_ffe ;};_dddd =_gaa .GetContentStreamOps ();_gbdc :=_gaa .Marks ();_gdbd :=_gaa .Text ();_gdbd ,_bccg :=_dfc (_gdbd );_dggcf :=[]matchedBBox {};
_gefc :=make (map[_fg .PdfObject ][]localSpanMarks );_ffcf :=[]*targetMap {};for _ ,_bgf :=range _bfde ._cca .Terms {_fff ,_gda :=_geee (_bgf );if _gda !=nil {return nil ,nil ,_gda ;};_fadb ,_gda :=_fff .match (_gdbd );if _gda !=nil {return nil ,nil ,_gda ;
};_fadb =_agdd (_fadb ,_bccg );_egbg :=_afgf (_fadb );_ffcf =append (_ffcf ,_egbg ...);};_gbdcf (_ffcf );for _ ,_ecgc :=range _ffcf {_gec :=_ecgc ._dcff ;_ega :=_ecgc ._eee ;_ebac :=[]matchedBBox {};for _ ,_gfe :=range _ega {_ffed ,_efad ,_cbegb :=_bcf (_gfe ,_gbdc ,_gec );
if _cbegb !=nil {return nil ,nil ,_cbegb ;};_faee :=_bgb (_ffed );for _agcf ,_bdea :=range _faee {_baad :=localSpanMarks {_cdd :_bdea ,_cddd :_agcf ,_ffa :_gec };_bcef ,_ :=_ba (_bdea );if _fbf ,_ceaf :=_gefc [_bcef ];_ceaf {_gefc [_bcef ]=append (_fbf ,_baad );
}else {_gefc [_bcef ]=[]localSpanMarks {_baad };};};_ebac =append (_ebac ,_efad );};_dggcf =append (_dggcf ,_ebac ...);};_ffe =_cb (_dddd ,_gefc );if _ffe !=nil {return nil ,nil ,_ffe ;};return _dggcf ,_dddd ,nil ;};type regexMatcher struct{_dcfc RedactionTerm };
func _agdd (_gcdf []*matchedIndex ,_ebb [][]int )[]*matchedIndex {_aced :=[]*matchedIndex {};for _ ,_dedg :=range _gcdf {_gbg ,_ggef :=_ffaa (_dedg ,_ebb );if _gbg {_gcdg :=_dage (_dedg ,_ggef );_aced =append (_aced ,_gcdg ...);}else {_aced =append (_aced ,_dedg );
};};return _aced ;};func _bgb (_gfa *_cf .TextMarkArray )[]*_cf .TextMarkArray {_aee :=_gfa .Elements ();_faed :=len (_aee );var _gebc _fg .PdfObject ;_fagd :=[]*_cf .TextMarkArray {};_cbaa :=&_cf .TextMarkArray {};_age :=-1;for _abg ,_aaga :=range _aee {_bgfg :=_aaga .DirectObject ;
_age =_aaga .Index ;if _bgfg ==nil {_eege :=_dfbc (_gfa ,_abg ,_age );if _gebc !=nil {if _eege ==-1||_eege > _abg {_fagd =append (_fagd ,_cbaa );_cbaa =&_cf .TextMarkArray {};};};}else if _bgfg !=nil &&_gebc ==nil {if _age ==0&&_abg > 0{_fagd =append (_fagd ,_cbaa );
_cbaa =&_cf .TextMarkArray {};};}else if _bgfg !=nil &&_gebc !=nil {if _bgfg !=_gebc {_fagd =append (_fagd ,_cbaa );_cbaa =&_cf .TextMarkArray {};};};_gebc =_bgfg ;_cbaa .Append (_aaga );if _abg ==(_faed -1){_fagd =append (_fagd ,_cbaa );};};return _fagd ;
};func _dage (_aff *matchedIndex ,_fbfa [][]int )[]*matchedIndex {_beeb :=[]*matchedIndex {};_ege :=_aff ._cafe ;_ecb :=_ege ;_fbg :=_aff ._egce ;_dfdg :=0;for _ ,_gaff :=range _fbfa {_gbc :=_gaff [0]-_ege ;if _dfdg >=_gbc {continue ;};_gcf :=_fbg [_dfdg :_gbc ];
_afe :=&matchedIndex {_egce :_gcf ,_cafe :_ecb ,_eeg :_gaff [0]};if len (_a .TrimSpace (_gcf ))!=0{_beeb =append (_beeb ,_afe );};_dfdg =_gaff [1]-_ege ;_ecb =_ege +_dfdg ;};_cga :=_fbg [_dfdg :];_abgb :=&matchedIndex {_egce :_cga ,_cafe :_ecb ,_eeg :_aff ._eeg };
if len (_a .TrimSpace (_cga ))!=0{_beeb =append (_beeb ,_abgb );};return _beeb ;};type placeHolders struct{_fe []int ;_dg string ;_ag float64 ;};func _fccb (_fbaf *_cf .TextMarkArray )string {_bdf :="";for _ ,_begf :=range _fbaf .Elements (){_bdf +=_begf .Text ;
};return _bdf ;};

// Redact executes the redact operation on a pdf file and updates the content streams of all pages of the file.
func (_edg *Redactor )Redact ()error {_acaf ,_bcg :=_edg ._dade .GetNumPages ();if _bcg !=nil {return _g .Errorf ("\u0066\u0061\u0069\u006c\u0065\u0064 \u0074\u006f\u0020\u0067\u0065\u0074\u0020\u0074\u0068\u0065\u0020\u006e\u0075m\u0062\u0065\u0072\u0020\u006f\u0066\u0020P\u0061\u0067\u0065\u0073");
};_egb :=_edg ._aaee .FillColor ;_gebb :=_edg ._aaee .BorderWidth ;_faeg :=_edg ._aaee .FillOpacity ;for _bbfe :=1;_bbfe <=_acaf ;_bbfe ++{_gdd ,_acaa :=_edg ._dade .GetPage (_bbfe );if _acaa !=nil {return _acaa ;};_egd ,_acaa :=_cf .New (_gdd );if _acaa !=nil {return _acaa ;
};_fcaf ,_ ,_ ,_acaa :=_egd .ExtractPageText ();if _acaa !=nil {return _acaa ;};_fgd :=_fcaf .GetContentStreamOps ();_fcafc ,_dag ,_acaa :=_edg .redactPage (_fgd ,_gdd .Resources );if _dag ==nil {_f .Log .Info ("N\u006f\u0020\u006d\u0061\u0074\u0063\u0068\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0066\u006f\u0072\u0020t\u0068\u0065\u0020\u0070\u0072\u006f\u0076\u0069\u0064\u0065d \u0070\u0061\u0074t\u0061r\u006e\u002e");
_dag =_fgd ;};_dee :=_be .ContentStreamOperation {Operand :"\u006e"};*_dag =append (*_dag ,&_dee );_gdd .SetContentStreams ([]string {_dag .String ()},_fg .NewFlateEncoder ());if _acaa !=nil {return _acaa ;};_bbb ,_acaa :=_gdd .GetMediaBox ();if _acaa !=nil {return _acaa ;
};if _gdd .MediaBox ==nil {_gdd .MediaBox =_bbb ;};if _feg :=_edg ._ggcf .AddPage (_gdd );_feg !=nil {return _feg ;};_d .Slice (_fcafc ,func (_cba ,_abdg int )bool {return _fcafc [_cba ]._bbcb < _fcafc [_abdg ]._bbcb });_ecef :=_bbb .Ury ;for _ ,_acab :=range _fcafc {_ggcb :=_acab ._bgdc ;
_dagc :=_edg ._ggcf .NewRectangle (_ggcb .Llx ,_ecef -_ggcb .Lly ,_ggcb .Urx -_ggcb .Llx ,-(_ggcb .Ury -_ggcb .Lly ));_dagc .SetFillColor (_egb );_dagc .SetBorderWidth (_gebb );_dagc .SetFillOpacity (_faeg );if _cffe :=_edg ._ggcf .Draw (_dagc );_cffe !=nil {return nil ;
};};};_edg ._ggcf .SetOutlineTree (_edg ._dade .GetOutlineTree ());return nil ;};func _dec (_eb *_cf .TextMarkArray )*_dd .PdfFont {_ ,_bfg :=_ba (_eb );_bgg :=_eb .Elements ()[_bfg ];_bgcb :=_bgg .Font ;return _bgcb ;};func _bccd (_ffd ,_acdb string )[]int {if len (_acdb )==0{return nil ;
};var _abed []int ;for _cbeg :=0;_cbeg < len (_ffd );{_gdc :=_a .Index (_ffd [_cbeg :],_acdb );if _gdc < 0{return _abed ;};_abed =append (_abed ,_cbeg +_gdc );_cbeg +=_gdc +len (_acdb );};return _abed ;};func _db (_dad *_be .ContentStreamOperations ,PdfObj _fg .PdfObject )(*_be .ContentStreamOperation ,int ,bool ){for _fbag ,_cbdd :=range *_dad {_bbab :=_cbdd .Operand ;
if _bbab =="\u0054\u006a"{_bfaa :=_fg .TraceToDirectObject (_cbdd .Params [0]);if _bfaa ==PdfObj {return _cbdd ,_fbag ,true ;};}else if _bbab =="\u0054\u004a"{_acd ,_becf :=_fg .GetArray (_cbdd .Params [0]);if !_becf {return nil ,_fbag ,_becf ;};for _ ,_egc :=range _acd .Elements (){if _egc ==PdfObj {return _cbdd ,_fbag ,true ;
};};}else if _bbab =="\u0022"{_gaf :=_fg .TraceToDirectObject (_cbdd .Params [2]);if _gaf ==PdfObj {return _cbdd ,_fbag ,true ;};}else if _bbab =="\u0027"{_ecc :=_fg .TraceToDirectObject (_cbdd .Params [0]);if _ecc ==PdfObj {return _cbdd ,_fbag ,true ;
};};};return nil ,-1,false ;};func _cdf (_fabe ,_bbcbc targetMap )(bool ,[]int ){_cdcbf :=_a .Contains (_fabe ._dcff ,_bbcbc ._dcff );var _ccad []int ;for _ ,_gfg :=range _fabe ._eee {for _dccf ,_dcbb :=range _bbcbc ._eee {if _dcbb [0]>=_gfg [0]&&_dcbb [1]<=_gfg [1]{_ccad =append (_ccad ,_dccf );
};};};return _cdcbf ,_ccad ;};func _dga (_ee []placeHolders )[]replacement {_fcg :=[]replacement {};for _ ,_fdb :=range _ee {_ecg :=_fdb ._fe ;_abeg :=_fdb ._dg ;_bbg :=_fdb ._ag ;for _ ,_ggg :=range _ecg {_eage :=replacement {_cge :_abeg ,_fb :_bbg ,_bd :_ggg };
_fcg =append (_fcg ,_eage );};};_d .Slice (_fcg ,func (_cdcba ,_dcab int )bool {return _fcg [_cdcba ]._bd < _fcg [_dcab ]._bd });return _fcg ;};

// RedactionOptions is a collection of RedactionTerm objects.
type RedactionOptions struct{Terms []RedactionTerm ;};type localSpanMarks struct{_cdd *_cf .TextMarkArray ;_cddd int ;_ffa string ;};func _ad (_ge *_be .ContentStreamOperations ,_aa string ,_adf int )error {_e :=_be .ContentStreamOperations {};var _af _be .ContentStreamOperation ;
for _bbc ,_gee :=range *_ge {if _bbc ==_adf {if _aa =="\u0027"{_cd :=_be .ContentStreamOperation {Operand :"\u0054\u002a"};_e =append (_e ,&_cd );_af .Params =_gee .Params ;_af .Operand ="\u0054\u006a";_e =append (_e ,&_af );}else if _aa =="\u0022"{_geb :=_gee .Params [:2];
Tc ,Tw :=_geb [0],_geb [1];_bbe :=_be .ContentStreamOperation {Params :[]_fg .PdfObject {Tc },Operand :"\u0054\u0063"};_e =append (_e ,&_bbe );_bbe =_be .ContentStreamOperation {Params :[]_fg .PdfObject {Tw },Operand :"\u0054\u0077"};_e =append (_e ,&_bbe );
_af .Params =[]_fg .PdfObject {_gee .Params [2]};_af .Operand ="\u0054\u006a";_e =append (_e ,&_af );};};_e =append (_e ,_gee );};*_ge =_e ;return nil ;};

// RedactRectanglePropsNew return a new pointer to a default RectangleProps object.
func RedactRectanglePropsNew ()*RectangleProps {return &RectangleProps {FillColor :_fa .ColorBlack ,BorderWidth :0.0,FillOpacity :1.0};};type matchedIndex struct{_cafe int ;_eeg int ;_egce string ;};func _bcge (_degd int ,_bed []int )bool {for _ ,_gdbgb :=range _bed {if _gdbgb ==_degd {return true ;
};};return false ;};func _ded (_bca string ,_eba []localSpanMarks )([]placeHolders ,error ){_agd :="";_beg :=[]placeHolders {};for _cbc ,_bgcbb :=range _eba {_bad :=_bgcbb ._cdd ;_bab :=_bgcbb ._ffa ;_bfa :=_fccb (_bad );_ffc ,_begb :=_bee (_bad );if _begb !=nil {return nil ,_begb ;
};if _bfa !=_agd {var _bbf []int ;if _cbc ==0&&_bab !=_bfa {_cdb :=_a .Index (_bca ,_bfa );_bbf =[]int {_cdb };}else if _cbc ==len (_eba )-1{_becb :=_a .LastIndex (_bca ,_bfa );_bbf =[]int {_becb };}else {_bbf =_bccd (_bca ,_bfa );};_cbe :=placeHolders {_fe :_bbf ,_dg :_bfa ,_ag :_ffc };
_beg =append (_beg ,_cbe );};_agd =_bfa ;};return _beg ,nil ;};